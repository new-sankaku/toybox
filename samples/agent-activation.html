<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>New Project</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-main: #E8E4D4;
      --bg-panel: #F2EFE5;
      --bg-dark: #2E2A24;
      --text-main: #2E2A24;
      --text-light: #6A665C;
      --text-dim: #9A968C;
      --border: #C8C4B4;
      --border-light: #D8D4C4;
      --accent: #8B7355;
      --accent-gold: #C4A882;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Noto Sans JP', sans-serif;
      background: var(--bg-main);
      color: var(--text-main);
      line-height: 1.6;
    }

    .app {
      min-height: 100vh;
      display: flex;
    }

    /* Left: Form area */
    .form-side {
      flex: 1;
      padding: 40px;
      overflow-y: auto;
      max-height: 100vh;
    }

    .form-header {
      margin-bottom: 32px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border);
    }

    .form-title {
      font-size: 11px;
      font-weight: 500;
      letter-spacing: 0.3em;
      color: var(--text-light);
      margin-bottom: 8px;
    }

    .form-subtitle {
      font-size: 20px;
      font-weight: 300;
    }

    /* Panel */
    .panel {
      background: var(--bg-panel);
      border: 1px solid var(--border);
      margin-bottom: 24px;
      transition: border-color 0.3s ease;
    }

    .panel.has-value {
      border-color: var(--accent);
    }

    .panel-header {
      padding: 12px 20px;
      border-bottom: 1px solid var(--border-light);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .panel-title {
      font-size: 10px;
      font-weight: 500;
      letter-spacing: 0.25em;
      color: var(--text-light);
    }

    .panel-status {
      font-size: 9px;
      letter-spacing: 0.15em;
      color: var(--text-dim);
      transition: color 0.3s;
    }

    .panel.has-value .panel-status {
      color: var(--accent);
    }

    .panel-body {
      padding: 20px;
    }

    /* Form fields */
    .field {
      margin-bottom: 20px;
    }

    .field:last-child {
      margin-bottom: 0;
    }

    .field-label {
      font-size: 11px;
      color: var(--text-light);
      margin-bottom: 8px;
      display: block;
    }

    .field-input {
      width: 100%;
      background: var(--bg-main);
      border: 1px solid var(--border);
      font-family: inherit;
      font-size: 14px;
      color: var(--text-main);
      padding: 12px 16px;
      outline: none;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    .field-input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(139, 115, 85, 0.1);
    }

    .field-input::placeholder {
      color: var(--text-dim);
    }

    .field-textarea {
      resize: vertical;
      min-height: 100px;
    }

    .field-select {
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%236A665C' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 12px center;
      padding-right: 36px;
    }

    .field-row {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
    }

    /* Agent checkboxes */
    .agent-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }

    .agent-check {
      display: flex;
      align-items: center;
      padding: 14px 16px;
      background: var(--bg-main);
      border: 1px solid var(--border);
      cursor: pointer;
      transition: all 0.2s;
    }

    .agent-check:hover {
      border-color: var(--text-dim);
    }

    .agent-check.checked {
      border-color: var(--accent);
      background: rgba(139, 115, 85, 0.05);
    }

    .agent-check-box {
      width: 16px;
      height: 16px;
      border: 1px solid var(--border);
      margin-right: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .agent-check.checked .agent-check-box {
      border-color: var(--accent);
      background: var(--accent);
    }

    .agent-check-box::after {
      content: '';
      width: 8px;
      height: 8px;
      background: var(--bg-panel);
      opacity: 0;
    }

    .agent-check.checked .agent-check-box::after {
      opacity: 1;
    }

    .agent-check-label {
      font-size: 12px;
    }

    .agent-check-role {
      font-size: 9px;
      color: var(--text-dim);
      margin-left: auto;
      letter-spacing: 0.1em;
    }

    /* Submit area */
    .submit-area {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      gap: 16px;
      padding-top: 16px;
      border-top: 1px solid var(--border);
    }

    .btn {
      font-family: inherit;
      font-size: 11px;
      letter-spacing: 0.15em;
      padding: 14px 32px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-ghost {
      background: none;
      border: 1px solid var(--border);
      color: var(--text-light);
    }

    .btn-ghost:hover {
      border-color: var(--text-main);
      color: var(--text-main);
    }

    .btn-primary {
      background: var(--text-main);
      border: 1px solid var(--text-main);
      color: var(--bg-main);
    }

    .btn-primary:hover {
      background: var(--accent);
      border-color: var(--accent);
    }

    .btn-primary:disabled {
      background: var(--text-dim);
      border-color: var(--text-dim);
      cursor: not-allowed;
    }

    /* Right: Blueprint area */
    .blueprint-side {
      width: 360px;
      background: var(--bg-dark);
      color: #E8E4D4;
      display: flex;
      flex-direction: column;
      position: sticky;
      top: 0;
      height: 100vh;
    }

    .blueprint-header {
      padding: 24px;
      border-bottom: 1px solid #3E3A34;
    }

    .blueprint-title {
      font-size: 9px;
      letter-spacing: 0.4em;
      color: #8A867E;
      margin-bottom: 8px;
    }

    .blueprint-name {
      font-size: 18px;
      font-weight: 300;
      min-height: 27px;
      color: #6A665C;
      transition: color 0.3s;
    }

    .blueprint-name.filled {
      color: #E8E4D4;
    }

    .blueprint-body {
      flex: 1;
      padding: 24px;
      overflow-y: auto;
    }

    /* Blueprint modules */
    .bp-module {
      margin-bottom: 20px;
      opacity: 0.3;
      transition: opacity 0.4s ease;
    }

    .bp-module.active {
      opacity: 1;
    }

    .bp-module-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }

    .bp-module-label {
      font-size: 8px;
      letter-spacing: 0.3em;
      color: #6A665C;
    }

    .bp-module.active .bp-module-label {
      color: var(--accent-gold);
    }

    .bp-module-status {
      font-size: 8px;
      letter-spacing: 0.15em;
      color: #4A4640;
    }

    .bp-module.active .bp-module-status {
      color: var(--accent-gold);
    }

    .bp-module-content {
      padding: 12px;
      border: 1px solid #3E3A34;
      min-height: 40px;
      font-size: 12px;
      color: #9A968E;
      transition: all 0.3s;
    }

    .bp-module.active .bp-module-content {
      border-color: #5A5650;
      color: #E8E4D4;
    }

    .bp-module-empty {
      color: #4A4640;
      font-style: italic;
    }

    .bp-module-value {
      opacity: 0;
      transform: translateY(5px);
      transition: all 0.3s ease;
    }

    .bp-module-value.show {
      opacity: 1;
      transform: translateY(0);
    }

    .bp-module-concept {
      font-size: 11px;
      line-height: 1.7;
      max-height: 80px;
      overflow: hidden;
    }

    /* Agent tags in blueprint */
    .bp-agents {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .bp-agent-tag {
      font-size: 9px;
      letter-spacing: 0.1em;
      padding: 6px 10px;
      border: 1px solid #3E3A34;
      color: #5A5650;
      opacity: 0;
      transform: scale(0.9);
      transition: all 0.25s ease;
    }

    .bp-agent-tag.show {
      opacity: 1;
      transform: scale(1);
    }

    .bp-agent-tag.active {
      border-color: var(--accent-gold);
      color: var(--accent-gold);
    }

    /* Progress bar */
    .bp-progress {
      margin-top: auto;
      padding-top: 20px;
    }

    .bp-progress-label {
      font-size: 8px;
      letter-spacing: 0.2em;
      color: #5A5650;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
    }

    .bp-progress-bar {
      height: 2px;
      background: #3E3A34;
    }

    .bp-progress-fill {
      height: 100%;
      background: var(--accent-gold);
      width: 0%;
      transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Blueprint footer */
    .blueprint-footer {
      padding: 24px;
      border-top: 1px solid #3E3A34;
    }

    .bp-launch-btn {
      width: 100%;
      background: transparent;
      border: 1px solid #4A4640;
      font-family: inherit;
      font-size: 11px;
      letter-spacing: 0.3em;
      color: #5A5650;
      padding: 18px;
      cursor: not-allowed;
      transition: all 0.3s ease;
    }

    .bp-launch-btn.ready {
      border-color: var(--accent-gold);
      color: var(--accent-gold);
      cursor: pointer;
    }

    .bp-launch-btn.ready:hover {
      background: var(--accent-gold);
      color: var(--bg-dark);
    }

    /* Launch overlay */
    .launch-overlay {
      position: fixed;
      inset: 0;
      background: var(--bg-main);
      display: none;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      z-index: 100;
    }

    .launch-overlay.active {
      display: flex;
    }

    .launch-flash {
      position: fixed;
      inset: 0;
      background: #fff;
      opacity: 0;
      pointer-events: none;
    }

    .launch-flash.show {
      animation: flash 0.4s ease-out;
    }

    @keyframes flash {
      0% { opacity: 0.8; }
      100% { opacity: 0; }
    }

    .launch-content {
      text-align: center;
    }

    .launch-label {
      font-size: 10px;
      letter-spacing: 0.4em;
      color: var(--text-light);
      margin-bottom: 16px;
      opacity: 0;
      transition: opacity 0.5s ease;
    }

    .launch-label.show { opacity: 1; }

    .launch-name {
      font-size: 36px;
      font-weight: 300;
      margin-bottom: 24px;
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.6s ease 0.2s;
    }

    .launch-name.show {
      opacity: 1;
      transform: translateY(0);
    }

    .launch-agents {
      display: flex;
      gap: 20px;
      justify-content: center;
    }

    .launch-agent {
      font-size: 10px;
      letter-spacing: 0.12em;
      color: var(--text-light);
      opacity: 0;
      transition: opacity 0.4s ease;
    }

    .launch-agent.show {
      opacity: 1;
    }

    /* Countdown */
    .countdown {
      position: fixed;
      inset: 0;
      background: var(--bg-dark);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 90;
    }

    .countdown.active { display: flex; }

    .countdown-num {
      font-size: 200px;
      font-weight: 200;
      color: #E8E4D4;
      opacity: 0;
      transform: scale(0.7);
    }

    .countdown-num.show {
      opacity: 1;
      transform: scale(1);
      transition: all 0.12s cubic-bezier(0.2, 0, 0.2, 1);
    }

    .countdown-num.out {
      opacity: 0;
      transform: scale(1.15);
      transition: all 0.08s ease-out;
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- Left: Form -->
    <div class="form-side">
      <div class="form-header">
        <div class="form-title">NEW PROJECT</div>
        <div class="form-subtitle">プロジェクト作成</div>
      </div>

      <form id="projectForm">
        <!-- Project Information -->
        <div class="panel" id="panelInfo">
          <div class="panel-header">
            <div class="panel-title">PROJECT INFORMATION</div>
            <div class="panel-status">WAITING</div>
          </div>
          <div class="panel-body">
            <div class="field">
              <label class="field-label">Project Name</label>
              <input type="text" class="field-input" id="inputName" placeholder="My Awesome Game">
            </div>
            <div class="field">
              <label class="field-label">Description (optional)</label>
              <textarea class="field-input field-textarea" id="inputDesc" placeholder="Brief description of your project..." rows="2"></textarea>
            </div>
          </div>
        </div>

        <!-- Game Concept -->
        <div class="panel" id="panelConcept">
          <div class="panel-header">
            <div class="panel-title">GAME CONCEPT</div>
            <div class="panel-status">WAITING</div>
          </div>
          <div class="panel-body">
            <div class="field">
              <label class="field-label">Game Concept</label>
              <textarea class="field-input field-textarea" id="inputConcept" placeholder="Describe your game idea in detail. What is the gameplay like? What makes it unique?" rows="4"></textarea>
            </div>
            <div class="field-row">
              <div class="field">
                <label class="field-label">Platform</label>
                <select class="field-input field-select" id="inputPlatform">
                  <option value="web">Web Browser</option>
                  <option value="desktop">Desktop</option>
                  <option value="mobile">Mobile (PWA)</option>
                </select>
              </div>
              <div class="field">
                <label class="field-label">Scope</label>
                <select class="field-input field-select" id="inputScope">
                  <option value="mvp">MVP</option>
                  <option value="full">Full Game</option>
                </select>
              </div>
              <div class="field">
                <label class="field-label">Genre</label>
                <select class="field-input field-select" id="inputGenre">
                  <option value="">Select...</option>
                  <option value="rpg">RPG</option>
                  <option value="action">Action</option>
                  <option value="puzzle">Puzzle</option>
                  <option value="adventure">Adventure</option>
                  <option value="simulation">Simulation</option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <!-- Agent Selection -->
        <div class="panel" id="panelAgents">
          <div class="panel-header">
            <div class="panel-title">AGENT TEAM</div>
            <div class="panel-status">WAITING</div>
          </div>
          <div class="panel-body">
            <div class="agent-grid">
              <div class="agent-check" data-agent="concept">
                <div class="agent-check-box"></div>
                <span class="agent-check-label">Concept Agent</span>
                <span class="agent-check-role">CREATIVE</span>
              </div>
              <div class="agent-check" data-agent="scenario">
                <div class="agent-check-box"></div>
                <span class="agent-check-label">Scenario Agent</span>
                <span class="agent-check-role">NARRATIVE</span>
              </div>
              <div class="agent-check" data-agent="character">
                <div class="agent-check-box"></div>
                <span class="agent-check-label">Character Agent</span>
                <span class="agent-check-role">DESIGN</span>
              </div>
              <div class="agent-check" data-agent="code">
                <div class="agent-check-box"></div>
                <span class="agent-check-label">Code Agent</span>
                <span class="agent-check-role">IMPLEMENT</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Actions -->
        <div class="submit-area">
          <button type="button" class="btn btn-ghost" id="btnCancel">Cancel</button>
          <button type="submit" class="btn btn-primary" id="btnSubmit" disabled>Create Project</button>
        </div>
      </form>
    </div>

    <!-- Right: Blueprint -->
    <div class="blueprint-side">
      <div class="blueprint-header">
        <div class="blueprint-title">PROJECT BLUEPRINT</div>
        <div class="blueprint-name" id="bpName">Untitled Project</div>
      </div>

      <div class="blueprint-body">
        <div class="bp-module" id="bpModInfo">
          <div class="bp-module-header">
            <div class="bp-module-label">IDENTITY</div>
            <div class="bp-module-status">-</div>
          </div>
          <div class="bp-module-content">
            <div class="bp-module-empty">未設定</div>
            <div class="bp-module-value" id="bpInfoValue"></div>
          </div>
        </div>

        <div class="bp-module" id="bpModConcept">
          <div class="bp-module-header">
            <div class="bp-module-label">CONCEPT</div>
            <div class="bp-module-status">-</div>
          </div>
          <div class="bp-module-content">
            <div class="bp-module-empty">未設定</div>
            <div class="bp-module-value bp-module-concept" id="bpConceptValue"></div>
          </div>
        </div>

        <div class="bp-module" id="bpModAgents">
          <div class="bp-module-header">
            <div class="bp-module-label">AGENTS</div>
            <div class="bp-module-status">-</div>
          </div>
          <div class="bp-module-content">
            <div class="bp-agents">
              <div class="bp-agent-tag show" data-for="concept">CONCEPT</div>
              <div class="bp-agent-tag show" data-for="scenario">SCENARIO</div>
              <div class="bp-agent-tag show" data-for="character">CHARACTER</div>
              <div class="bp-agent-tag show" data-for="code">CODE</div>
            </div>
          </div>
        </div>

        <div class="bp-progress">
          <div class="bp-progress-label">
            <span>COMPLETION</span>
            <span id="bpProgressPct">0%</span>
          </div>
          <div class="bp-progress-bar">
            <div class="bp-progress-fill" id="bpProgressFill"></div>
          </div>
        </div>
      </div>

      <div class="blueprint-footer">
        <button class="bp-launch-btn" id="bpLaunchBtn">INITIALIZE PROJECT</button>
      </div>
    </div>

    <!-- Countdown -->
    <div class="countdown" id="countdown">
      <div class="countdown-num" id="countdownNum">3</div>
    </div>

    <!-- Launch overlay -->
    <div class="launch-overlay" id="launchOverlay">
      <div class="launch-flash" id="launchFlash"></div>
      <div class="launch-content">
        <div class="launch-label" id="launchLabel">PROJECT INITIALIZED</div>
        <div class="launch-name" id="launchName">-</div>
        <div class="launch-agents" id="launchAgents"></div>
      </div>
    </div>
  </div>

  <script>
    const Audio = {
      ctx: null,
      init() {
        if (!this.ctx) this.ctx = new (window.AudioContext || window.webkitAudioContext)();
        if (this.ctx.state === 'suspended') this.ctx.resume();
      },
      play(freq, dur, delay = 0, vol = 0.03) {
        if (!this.ctx) return;
        const t = this.ctx.currentTime + delay;
        const o = this.ctx.createOscillator();
        const g = this.ctx.createGain();
        o.connect(g); g.connect(this.ctx.destination);
        o.frequency.value = freq;
        g.gain.setValueAtTime(0, t);
        g.gain.linearRampToValueAtTime(vol, t + 0.01);
        g.gain.exponentialRampToValueAtTime(0.001, t + dur);
        o.start(t); o.stop(t + dur);
      },
      lock() { this.play(400, 0.1, 0, 0.04); this.play(600, 0.08, 0.05, 0.03); },
      select() { this.play(350, 0.08, 0, 0.03); },
      count() { this.play(440, 0.08, 0, 0.05); },
      launch() {
        this.play(300, 0.4, 0, 0.06);
        this.play(450, 0.35, 0.05, 0.05);
        this.play(600, 0.3, 0.1, 0.04);
      },
      complete() {
        this.play(523, 0.15, 0, 0.05);
        this.play(659, 0.12, 0.1, 0.04);
        this.play(784, 0.2, 0.2, 0.05);
      }
    };

    const State = {
      name: '',
      desc: '',
      concept: '',
      platform: 'web',
      scope: 'mvp',
      genre: '',
      agents: new Set()
    };

    const $ = id => document.getElementById(id);
    const sleep = ms => new Promise(r => setTimeout(r, ms));

    function updateProgress() {
      let score = 0;
      if (State.name) score += 25;
      if (State.concept && State.concept.length >= 20) score += 35;
      if (State.agents.size > 0) score += 40;

      $('bpProgressFill').style.width = score + '%';
      $('bpProgressPct').textContent = score + '%';

      const canSubmit = State.name && State.concept && State.concept.length >= 20 && State.agents.size > 0;
      $('btnSubmit').disabled = !canSubmit;
      $('bpLaunchBtn').classList.toggle('ready', canSubmit);
    }

    function updateModule(modId, panelId, isActive) {
      const mod = $(modId);
      const panel = $(panelId);
      mod.classList.toggle('active', isActive);
      panel.classList.toggle('has-value', isActive);

      const status = isActive ? 'LOCKED' : '-';
      mod.querySelector('.bp-module-status').textContent = status;
      panel.querySelector('.panel-status').textContent = isActive ? 'SET' : 'WAITING';
    }

    function onNameChange() {
      const val = $('inputName').value.trim();
      State.name = val;

      $('bpName').textContent = val || 'Untitled Project';
      $('bpName').classList.toggle('filled', !!val);

      const isEmpty = !val;
      $('bpModInfo').querySelector('.bp-module-empty').style.display = isEmpty ? '' : 'none';
      $('bpInfoValue').textContent = val;
      $('bpInfoValue').classList.toggle('show', !isEmpty);

      updateModule('bpModInfo', 'panelInfo', !!val);
      if (val) Audio.lock();
      updateProgress();
    }

    function onConceptChange() {
      const val = $('inputConcept').value.trim();
      State.concept = val;

      const isValid = val.length >= 20;
      const isEmpty = !val;

      $('bpModConcept').querySelector('.bp-module-empty').style.display = isEmpty ? '' : 'none';
      const display = val.length > 100 ? val.substring(0, 100) + '...' : val;
      $('bpConceptValue').textContent = display;
      $('bpConceptValue').classList.toggle('show', !isEmpty);

      updateModule('bpModConcept', 'panelConcept', isValid);
      updateProgress();
    }

    function toggleAgent(agent) {
      const check = document.querySelector(`.agent-check[data-agent="${agent}"]`);
      const tag = document.querySelector(`.bp-agent-tag[data-for="${agent}"]`);

      if (State.agents.has(agent)) {
        State.agents.delete(agent);
        check.classList.remove('checked');
        tag.classList.remove('active');
      } else {
        State.agents.add(agent);
        check.classList.add('checked');
        tag.classList.add('active');
        Audio.select();
      }

      updateModule('bpModAgents', 'panelAgents', State.agents.size > 0);
      updateProgress();
    }

    async function runCountdown() {
      $('countdown').classList.add('active');
      const num = $('countdownNum');

      await sleep(200);

      for (let i = 3; i >= 1; i--) {
        num.textContent = i;
        num.classList.remove('show', 'out');
        await sleep(30);
        num.classList.add('show');
        Audio.count();
        await sleep(400);
        num.classList.add('out');
        num.classList.remove('show');
        await sleep(120);
      }

      Audio.launch();
      await sleep(150);
    }

    async function launch() {
      Audio.init();
      await runCountdown();

      $('countdown').classList.remove('active');
      $('launchOverlay').classList.add('active');
      $('launchFlash').classList.add('show');

      await sleep(250);
      $('launchLabel').classList.add('show');

      await sleep(150);
      $('launchName').textContent = State.name;
      $('launchName').classList.add('show');

      await sleep(350);
      const container = $('launchAgents');
      let i = 0;
      State.agents.forEach(agent => {
        const span = document.createElement('span');
        span.className = 'launch-agent';
        span.textContent = agent.toUpperCase();
        container.appendChild(span);
        setTimeout(() => span.classList.add('show'), i * 80);
        i++;
      });

      Audio.complete();
    }

    // Events
    $('inputName').addEventListener('input', onNameChange);
    $('inputName').addEventListener('blur', () => { if (State.name) Audio.lock(); });

    $('inputConcept').addEventListener('input', onConceptChange);
    $('inputConcept').addEventListener('blur', () => { if (State.concept.length >= 20) Audio.lock(); });

    document.querySelectorAll('.agent-check').forEach(check => {
      check.addEventListener('click', () => {
        Audio.init();
        toggleAgent(check.dataset.agent);
      });
    });

    $('projectForm').addEventListener('submit', e => {
      e.preventDefault();
      launch();
    });

    $('bpLaunchBtn').addEventListener('click', () => {
      if ($('bpLaunchBtn').classList.contains('ready')) {
        launch();
      }
    });

    document.addEventListener('click', () => Audio.init(), { once: true });
  </script>
</body>
</html>
