# Agentへの依頼の単一化

## 概要

WORKERへの依頼は必ず1つのタスクに限定する。
複数の依頼を同時に行うと精度が低下するため、LEADERが複合タスクを単一タスクに分解してからWORKERに渡す。

## 原則

**1 WORKER = 1 TASK = 1 OUTPUT**

| NG | OK |
|----|-----|
| 「ジャンプとダッシュを実装して」 | 「ジャンプを実装して」→「ダッシュを実装して」 |
| 「敵AIを作って、あとUIも」 | 「敵AIを作って」→「UIを作って」 |
| 「バグ修正とリファクタリング」 | 「バグ修正」→「リファクタリング」 |

## WORKERの依頼確認

WORKERは依頼を受け取ったら、まず内容が明確か確認する。
不足や曖昧な点があればLEADERに明確化を依頼する。

### 確認項目

| 項目 | 確認内容 |
|------|---------|
| 目的 | objectiveが指定されているか |
| 入力 | 入力ファイルが指定されているか |
| 出力 | 出力先が指定されているか |
| 完了条件 | acceptance_criteriaが指定されているか |

不明点があればClarificationRequestとしてLEADERに返す。
LEADERは不明点を補完してタスクを再送信。

## タスク定義フォーマット

### 必須項目

| フィールド | 説明 |
|-----------|------|
| task_id | タスクID（例: task_p2_code_003） |
| priority | 優先度（1が最高） |
| objective | 具体的な目的 |
| inputs | 入力ファイルと用途 |
| output | 出力（type, target, description） |
| acceptance_criteria | 完了条件のリスト |
| forbidden | 禁止事項のリスト |

## スコープ制限（DB管理）

スコープ制限の閾値はDBで管理し、WebUIから調整可能。

### task_scope_configテーブル

| key | 初期値 | 説明 |
|-----|-------|------|
| max_modified_files | 3 | 1タスクで変更可能な最大ファイル数 |
| max_added_lines | 200 | 1タスクで追加可能な最大行数 |
| max_dependencies | 5 | 1タスクの最大依存数 |

### WebUI設定画面

| 設定項目 | DB key | 説明 |
|---------|--------|------|
| 変更ファイル上限 | max_modified_files | スライダー（1〜10） |
| 追加行数上限 | max_added_lines | 数値入力 |
| 依存数上限 | max_dependencies | スライダー（1〜10） |

## LEADERによるタスク分解

### 分解プロセス

1. タスクの要素を抽出
2. 依存関係を分析
3. 優先度を決定（依存されているものほど高優先度）
4. 単一タスクに分解
5. 優先度順にソート

### 分解例

**入力（複合タスク）:**
「プレイヤーキャラクターの移動システムを実装してください。左右移動、ジャンプ、ダッシュができるようにしてください。」

**出力（単一タスク群・優先度付き）:**

| タスクID | 優先度 | 目的 | 依存 |
|---------|--------|------|------|
| task_p2_code_001 | 1 | PlayerControllerの基本クラス構造を作成する | なし |
| task_p2_code_002 | 2 | 左右移動機能を実装する | 001 |
| task_p2_code_003 | 2 | ジャンプ機能を実装する | 001 |
| task_p2_code_004 | 3 | ダッシュ機能を実装する | 002（移動の拡張） |

## メリット

| メリット | 説明 |
|---------|------|
| 精度向上 | 1つのことに集中できる |
| デバッグ容易 | 問題の特定が簡単 |
| 並列化可能 | 依存のないタスクは並列実行 |
| 進捗把握 | 細かい単位で進捗がわかる |
| ロールバック容易 | 問題のあるタスクだけ取り消し |
