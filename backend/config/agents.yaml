agents:
  concept:
    label: コンセプト
    short_label: コンセプト
    phase: 0
    speech_bubble: 企画を立案します
    quality_check: true
    high_cost: false
    role: leader
    usage_category: llm_high

  task_split_1:
    label: タスク分割1
    short_label: 分割1
    phase: 1
    speech_bubble: 設計タスクを分配します
    quality_check: true
    high_cost: false
    role: splitter
    max_tokens: 8192
    usage_category: llm_mid

  concept_detail:
    label: コンセプト
    short_label: コンセプト
    phase: 2
    speech_bubble: 企画を練り上げます
    quality_check: true
    high_cost: false
    role: worker
    usage_category: llm_high

  scenario:
    label: シナリオ
    short_label: シナリオ
    phase: 2
    speech_bubble: 物語を紡ぎます
    quality_check: true
    high_cost: false
    role: worker
    usage_category: llm_high

  world:
    label: 世界観
    short_label: 世界観
    phase: 2
    speech_bubble: 世界を創造します
    quality_check: true
    high_cost: false
    role: worker
    usage_category: llm_high

  game_design:
    label: ゲームデザイン
    short_label: デザイン
    phase: 2
    speech_bubble: システムを設計します
    quality_check: true
    high_cost: false
    role: worker
    usage_category: llm_high

  tech_spec:
    label: 技術仕様
    short_label: テック
    phase: 2
    speech_bubble: 技術を検証します
    quality_check: true
    high_cost: false
    role: worker
    usage_category: llm_high

  task_split_2:
    label: タスク分割2
    short_label: 分割2
    phase: 3
    speech_bubble: アセットタスクを分配
    quality_check: true
    high_cost: false
    role: splitter
    max_tokens: 8192
    usage_category: llm_mid

  asset_character:
    label: キャラクター
    short_label: キャラ
    phase: 4
    speech_bubble: キャラを描くにゃ
    quality_check: true
    high_cost: true
    role: worker
    usage_category: llm_mid

  asset_background:
    label: 背景
    short_label: 背景
    phase: 4
    speech_bubble: 背景を観察中...
    quality_check: true
    high_cost: true
    role: worker
    usage_category: llm_mid

  asset_ui:
    label: UI
    short_label: UI
    phase: 4
    speech_bubble: UIをデザイン中
    quality_check: true
    high_cost: true
    role: worker
    usage_category: llm_mid

  asset_effect:
    label: エフェクト
    short_label: エフェクト
    phase: 4
    speech_bubble: キラキラを作るよ
    quality_check: true
    high_cost: true
    role: worker
    usage_category: llm_mid

  asset_bgm:
    label: BGM
    short_label: BGM
    phase: 4
    speech_bubble: 旋律を奏でます
    quality_check: true
    high_cost: true
    role: worker
    usage_category: llm_mid

  asset_voice:
    label: ボイス
    short_label: ボイス
    phase: 4
    speech_bubble: 声を届けます
    quality_check: true
    high_cost: true
    role: worker
    usage_category: llm_mid

  asset_sfx:
    label: 効果音
    short_label: 効果音
    phase: 4
    speech_bubble: 音を探索中...
    quality_check: true
    high_cost: true
    role: worker
    usage_category: llm_mid

  task_split_3:
    label: タスク分割3
    short_label: 分割3
    phase: 5
    speech_bubble: 実装タスクを分配
    quality_check: true
    high_cost: false
    role: splitter
    max_tokens: 8192
    usage_category: llm_mid

  code:
    label: コード
    short_label: コード
    phase: 6
    speech_bubble: コード...実装中...
    quality_check: true
    high_cost: false
    role: worker
    usage_category: llm_high

  event:
    label: イベント
    short_label: イベント
    phase: 6
    speech_bubble: イベントを仕込む
    quality_check: true
    high_cost: false
    role: worker
    usage_category: llm_high

  ui_integration:
    label: UI統合
    short_label: UI統合
    phase: 6
    speech_bubble: UI部品を組み立て中
    quality_check: true
    high_cost: false
    role: worker
    usage_category: llm_mid

  asset_integration:
    label: アセット統合
    short_label: 統合
    phase: 6
    speech_bubble: アセットを統合中
    quality_check: true
    high_cost: false
    role: integrator
    usage_category: llm_mid

  task_split_4:
    label: タスク分割4
    short_label: 分割4
    phase: 7
    speech_bubble: テストタスクを分配
    quality_check: true
    high_cost: false
    role: splitter
    max_tokens: 8192
    usage_category: llm_mid

  unit_test:
    label: 単体テスト
    short_label: テスト1
    phase: 8
    speech_bubble: バグを焼き尽くす！
    quality_check: true
    high_cost: false
    role: tester
    usage_category: llm_mid

  integration_test:
    label: 統合テスト
    short_label: テスト2
    phase: 8
    speech_bubble: 慎重にテスト中...
    quality_check: true
    high_cost: false
    role: tester
    usage_category: llm_mid

workflow_dependencies:
  concept: []
  task_split_1: [concept]
  concept_detail:
    depends_on: [task_split_1]
    context_from:
      task_split_1:
        level: summary
        focus: コンセプト詳細化に必要なタスク構成と企画の核心要素
  scenario:
    depends_on: [task_split_1]
    context_from:
      task_split_1:
        level: summary
        focus: シナリオ構成に必要なタスク分割結果と世界観・キャラクター設定の要点
  world:
    depends_on: [task_split_1]
    context_from:
      task_split_1:
        level: summary
        focus: 世界観構築に必要な舞台設定・地理・文化に関するタスクと設定要素
  game_design:
    depends_on: [task_split_1]
    context_from:
      task_split_1:
        level: summary
        focus: ゲームシステム設計に必要なメカニクス・バランス・プレイヤー体験に関する要素
  tech_spec:
    depends_on: [task_split_1]
    context_from:
      task_split_1:
        level: summary
        focus: 技術仕様策定に必要なプラットフォーム・技術スタック・パフォーマンス要件
  task_split_2:
    depends_on: [concept_detail, scenario, world, game_design, tech_spec]
    context_from:
      concept_detail:
        level: summary
        focus: アセット制作タスク分割に必要なコンセプトの決定事項と仕様値
      scenario:
        level: summary
        focus: アセット制作に必要なシーン構成・登場キャラクター・演出要件
      world:
        level: summary
        focus: アセット制作に必要な世界観ビジュアル・雰囲気・環境設定
      game_design:
        level: summary
        focus: アセット制作に必要なUI仕様・ゲームメカニクスが求めるビジュアル要素
      tech_spec:
        level: summary
        focus: アセット制作の技術制約（解像度・フォーマット・パフォーマンス上限）
  asset_character:
    depends_on: [task_split_2]
    context_from:
      task_split_2:
        level: full
        focus: キャラクターアセット制作に関するタスク指示と仕様
  asset_background:
    depends_on: [task_split_2]
    context_from:
      task_split_2:
        level: full
        focus: 背景アセット制作に関するタスク指示と仕様
  asset_ui:
    depends_on: [task_split_2]
    context_from:
      task_split_2:
        level: full
        focus: UIアセット制作に関するタスク指示と仕様
  asset_effect:
    depends_on: [task_split_2]
    context_from:
      task_split_2:
        level: full
        focus: エフェクトアセット制作に関するタスク指示と仕様
  asset_bgm:
    depends_on: [task_split_2]
    context_from:
      task_split_2:
        level: full
        focus: BGM制作に関するタスク指示と音楽的要件
  asset_voice:
    depends_on: [task_split_2]
    context_from:
      task_split_2:
        level: full
        focus: ボイス制作に関するタスク指示とキャラクター音声要件
  asset_sfx:
    depends_on: [task_split_2]
    context_from:
      task_split_2:
        level: full
        focus: 効果音制作に関するタスク指示とサウンド要件
  task_split_3:
    depends_on: [asset_character, asset_background, asset_ui, asset_effect, asset_bgm, asset_voice, asset_sfx]
    context_from:
      asset_character:
        level: summary
        focus: 実装フェーズで利用するキャラクターアセットの成果物一覧と仕様
      asset_background:
        level: summary
        focus: 実装フェーズで利用する背景アセットの成果物一覧と仕様
      asset_ui:
        level: summary
        focus: 実装フェーズで利用するUIアセットの成果物一覧と仕様
      asset_effect:
        level: summary
        focus: 実装フェーズで利用するエフェクトアセットの成果物一覧
      asset_bgm:
        level: summary
        focus: 実装フェーズで利用するBGMアセットの成果物一覧
      asset_voice:
        level: summary
        focus: 実装フェーズで利用するボイスアセットの成果物一覧
      asset_sfx:
        level: summary
        focus: 実装フェーズで利用する効果音アセットの成果物一覧
  code:
    depends_on: [task_split_3]
    context_from:
      task_split_3:
        level: full
        focus: コード実装に関するタスク指示・技術仕様・利用アセット情報
  event:
    depends_on: [task_split_3]
    context_from:
      task_split_3:
        level: full
        focus: イベント実装に関するタスク指示・シナリオ連携・演出仕様
  ui_integration:
    depends_on: [task_split_3]
    context_from:
      task_split_3:
        level: full
        focus: UI統合に関するタスク指示・UIアセット配置・画面遷移仕様
  asset_integration:
    depends_on: [task_split_3]
    context_from:
      task_split_3:
        level: full
        focus: アセット統合に関するタスク指示・ファイルパス・リソース管理仕様
  task_split_4:
    depends_on: [code, event, ui_integration, asset_integration]
    context_from:
      code:
        level: summary
        focus: テスト対象となるコード実装の構成・エントリポイント・主要関数
      event:
        level: summary
        focus: テスト対象となるイベント処理の構成と期待動作
      ui_integration:
        level: summary
        focus: テスト対象となるUI統合の画面構成と操作フロー
      asset_integration:
        level: summary
        focus: テスト対象となるアセット統合のリソース構成と読み込みフロー
  unit_test:
    depends_on: [task_split_4]
    context_from:
      task_split_4:
        level: full
        focus: 単体テストに関するタスク指示・テスト対象・期待動作
  integration_test:
    depends_on: [task_split_4]
    context_from:
      task_split_4:
        level: full
        focus: 統合テストに関するタスク指示・テストシナリオ・期待動作

phases:
  phase0_concept:
    label: 企画
    agents: [concept]
  phase1_task_split:
    label: 分割1
    agents: [task_split_1]
  phase2_design:
    label: 設計
    agents: [concept_detail, scenario, world, game_design, tech_spec]
  phase3_task_split:
    label: 分割2
    agents: [task_split_2]
  phase4_assets:
    label: アセット
    agents: [asset_character, asset_background, asset_ui, asset_effect, asset_bgm, asset_voice, asset_sfx]
  phase5_task_split:
    label: 分割3
    agents: [task_split_3]
  phase6_implementation:
    label: 実装
    agents: [code, event, ui_integration, asset_integration]
  phase7_task_split:
    label: 分割4
    agents: [task_split_4]
  phase8_testing:
    label: テスト
    agents: [unit_test, integration_test]

ui_phases:
  - id: concept
    label: 企画
    agents: [concept]
  - id: split1
    label: 分割1
    agents: [task_split_1]
  - id: design
    label: 設計
    agents: [concept_detail, scenario, world, game_design, tech_spec]
  - id: split2
    label: 分割2
    agents: [task_split_2]
  - id: assets
    label: アセット
    agents: [asset_character, asset_background, asset_ui, asset_effect, asset_bgm, asset_voice, asset_sfx]
  - id: split3
    label: 分割3
    agents: [task_split_3]
  - id: impl
    label: 実装
    agents: [code, event, ui_integration, asset_integration]
  - id: split4
    label: 分割4
    agents: [task_split_4]
  - id: test
    label: テスト
    agents: [unit_test, integration_test]

agent_asset_mapping:
  enableImageGeneration:
    - asset_character
    - asset_background
    - asset_ui
    - asset_effect
  enableBGMGeneration:
    - asset_bgm
    - asset_sfx
  enableVoiceSynthesis:
    - asset_voice
  enableVideoGeneration: []

# --- トークン予算 ---
# プロジェクト全体のトークン使用量を制御する
token_budget:
  default_limit: 500000              # プロジェクトあたりの最大トークン数
  warning_threshold_percent: 80      # 警告を出す使用率(%)
  enforcement: hard                  # hard=超過時にエラー, soft=警告のみ

# --- コンテキストポリシー ---
# エージェント間で渡すコンテキストのサイズ制御
context_policy_settings:
  auto_downgrade_threshold: 15000    # full指定でもこの文字数を超えたらsummaryに自動切替(文字)
  summary_max_length: 10000          # summaryモード時の最大文字数
  leader_output_max_for_worker: 5000 # WorkerへのLeader出力の最大文字数
  retry_previous_output_max: 3000    # 品質チェックリトライ時に渡す前回出力の最大文字数
  # LLMによる要約生成
  llm_summary:
    enabled: true                    # LLM要約を使用するか(falseならテキスト切り詰め)
    usage_category: llm_low          # 要約に使うLLMのusage_category（プロジェクト設定から解決）
    max_tokens: 2048                 # 要約の最大出力トークン数
    min_content_length: 500          # この文字数未満なら要約せずそのまま返す
    input_max_length: 30000          # 要約LLMに渡すコンテンツの最大文字数
  # 要約時の保持方針（LLMへの指示）
  summary_directive: |
    以下の情報カテゴリのうち、元の出力に存在するものを優先的に保持してください。
    存在しないカテゴリは無視してください。
    - 固有名詞（名称・用語など、後続の作業で参照される識別子）
    - 数値・仕様（数量、サイズ、制限値など定量的な情報）
    - 構造的決定事項（採用した方式、選択した手法、確定した仕様）
    - 依存関係（他のエージェント出力と関連する情報）

# --- Temperature設定 ---
# roleごとのデフォルトtemperature（個別エージェントでtemperatureを指定すれば上書き可能）
temperature_defaults:
  leader: 0.7
  worker: 0.5
  splitter: 0.3
  integrator: 0.4
  tester: 0.3
  default: 0.7

# --- DAG並列実行 ---
# task_splitが出力するworker_tasksのDAG依存関係に基づき並列実行する
dag_execution:
  enabled: true                      # DAG並列実行を有効にするか（falseなら従来の逐次実行）

# --- 品質チェック ---
quality_check_defaults:
  max_retries: 3                     # 品質チェック不合格時の最大リトライ回数

# --- Skill Runnerのタスク制限 ---
# マルチターンツール実行ループの制御パラメータ
task_limits:
  default_max_tool_iterations: 50    # ツール実行ループの最大イテレーション数
  loop_detection_window: 6           # ループ検出の直近N回を監視
  loop_detection_repeat_threshold: 3 # window内で同一パターンがN回以上でループ判定
  message_window_size: 6             # 圧縮後に保持する直近メッセージ数
  message_compaction_trigger: 10     # この数を超えたら古いメッセージを圧縮
  tool_result_max_length: 5000       # ツール実行結果をLLMに渡す際の最大文字数
  previous_output_max_length: 2000   # 前エージェント出力をSkill Runnerに渡す際の最大文字数
  skill_log_output_max: 500          # スキル実行結果のログ出力の最大文字数
  compaction_assistant_max: 300      # メッセージ圧縮時のassistant応答要約の最大文字数
  compaction_system_max: 200         # メッセージ圧縮時のシステム通知要約の最大文字数
  compaction_user_max: 200           # メッセージ圧縮時のユーザーメッセージ要約の最大文字数

agent_principles:
  concept: [game_experience, game_mechanics]
  concept_detail: [game_experience, game_mechanics]
  scenario: [narrative_design, character_design]
  world: [world_building, narrative_design]
  game_design: [game_mechanics, game_experience]
  tech_spec: [technical_quality]
  asset_character: [character_design, visual_direction]
  asset_background: [world_building, visual_direction]
  asset_ui: [visual_direction, game_mechanics]
  asset_effect: [visual_direction]
  asset_bgm: [game_experience]
  asset_voice: [character_design, narrative_design]
  asset_sfx: [game_experience]
  code: [technical_quality, game_mechanics]
  event: [narrative_design, game_mechanics]
  ui_integration: [visual_direction, technical_quality]
  asset_integration: [visual_direction, technical_quality]
  unit_test: [technical_quality]
  integration_test: [technical_quality]
  task_split_1: [game_experience]
  task_split_2: [game_experience]
  task_split_3: [technical_quality]
  task_split_4: [technical_quality]
  _default: [game_experience]

principle_settings:
  max_chars_per_agent: 12000
  injection_mode: system
  quality_check_usage_category: llm_low  # 品質チェックLLMのusage_category（プロジェクト設定から解決）
  quality_check_max_tokens: 2048
  quality_threshold: 0.6
  # 品質チェックエスカレーション: 境界スコアの場合に上位モデルで再評価
  escalation:
    enabled: true
    tier2_usage_category: llm_mid    # エスカレーション先のusage_category
    tier2_score_min: 0.5             # この範囲のスコアをTier2で再評価
    tier2_score_max: 0.7

# --- エージェント出力の構造要件 ---
output_requirements:
  concept:
    required_sections: [コアファンタジー, ターゲット, メカニクス概要]
    min_length: 500
  concept_detail:
    required_sections: [ゲーム概要, 主要機能, ユーザー体験]
    min_length: 800
  scenario:
    required_sections: [あらすじ, イベント構成]
    min_length: 800
  world:
    required_sections: [世界観概要, 舞台設定]
    min_length: 500
  game_design:
    required_sections: [コアループ, 操作体系]
    min_length: 1000
  tech_spec:
    required_sections: [アーキテクチャ, 技術スタック]
    min_length: 800
  code:
    min_length: 200
  unit_test:
    min_length: 200
  integration_test:
    min_length: 200
  _default:
    min_length: 200

agent_generation_types:
  llm:
    - concept
    - task_split_1
    - concept_detail
    - game_design
    - tech_spec
    - code
    - event
    - ui_integration
    - asset_integration
    - unit_test
    - integration_test
    - task_split_2
    - task_split_3
    - task_split_4
  image:
    - asset_character
    - asset_background
    - asset_ui
    - asset_effect
  audio:
    - world
    - asset_bgm
    - asset_voice
    - asset_sfx
  dialogue:
    - scenario

agent_assets:
  concept:
    - progress: 50
      type: document
      name: concept_draft.md
      size: 12KB
    - progress: 90
      type: document
      name: concept_final.md
      size: 28KB

  task_split_1:
    - progress: 50
      type: document
      name: task_breakdown.md
      size: 25KB
    - progress: 90
      type: document
      name: iteration_plan.md
      size: 35KB

  concept_detail:
    - progress: 50
      type: document
      name: concept_detail_draft.md
      size: 18KB
    - progress: 90
      type: document
      name: concept_detail.md
      size: 32KB

  scenario:
    - progress: 40
      type: document
      name: story_outline.md
      size: 15KB
    - progress: 70
      type: document
      name: stage_design.md
      size: 22KB
    - progress: 90
      type: document
      name: dialogue_script.md
      size: 35KB

  world:
    - progress: 25
      type: image
      name: bg_grassland.png
      size: 1.8MB
    - progress: 45
      type: image
      name: bg_cave.png
      size: 2.1MB
    - progress: 60
      type: image
      name: bg_sky.png
      size: 1.6MB
    - progress: 75
      type: audio
      name: bgm_grassland.wav
      size: 3.2MB
    - progress: 85
      type: audio
      name: bgm_cave.wav
      size: 2.8MB
    - progress: 95
      type: audio
      name: bgm_sky.wav
      size: 3.5MB

  game_design:
    - progress: 30
      type: document
      name: mechanics_spec.md
      size: 18KB
    - progress: 45
      type: image
      name: ui_wireframe_01.png
      size: 245KB
    - progress: 55
      type: image
      name: ui_wireframe_02.png
      size: 312KB
    - progress: 70
      type: document
      name: sound_spec.md
      size: 8KB
    - progress: 95
      type: document
      name: game_design.md
      size: 42KB

  tech_spec:
    - progress: 50
      type: document
      name: tech_spec_draft.md
      size: 20KB
    - progress: 90
      type: document
      name: tech_spec.md
      size: 38KB

  asset_character:
    - progress: 35
      type: image
      name: ball_concept.png
      size: 156KB
    - progress: 50
      type: image
      name: ball_sprite_sheet.png
      size: 512KB
    - progress: 65
      type: image
      name: guide_character.png
      size: 234KB
    - progress: 80
      type: image
      name: boss_enemy.png
      size: 445KB
    - progress: 95
      type: document
      name: character_specs.md
      size: 18KB

  code:
    - progress: 30
      type: document
      name: main.ts
      size: 8KB
    - progress: 60
      type: document
      name: utils.ts
      size: 4KB
    - progress: 90
      type: document
      name: game.ts
      size: 12KB

agent_checkpoints:
  concept:
    - progress: 90
      type: concept_review
      title: ゲームコンセプトの承認

  task_split_1:
    - progress: 90
      type: task_review_1
      title: タスク分割1のレビュー

  concept_detail:
    - progress: 90
      type: concept_detail_review
      title: コンセプト詳細のレビュー

  scenario:
    - progress: 90
      type: scenario_review
      title: シナリオ構成のレビュー

  world:
    - progress: 90
      type: world_review
      title: 世界観設計のレビュー

  game_design:
    - progress: 90
      type: game_design_review
      title: ゲームデザインのレビュー

  tech_spec:
    - progress: 90
      type: tech_spec_review
      title: 技術仕様のレビュー

  task_split_2:
    - progress: 90
      type: task_review_2
      title: タスク分割2のレビュー

  asset_character:
    - progress: 90
      type: character_review
      title: キャラアセットのレビュー

  asset_ui:
    - progress: 90
      type: ui_review
      title: UIアセットのレビュー

  task_split_3:
    - progress: 90
      type: task_review_3
      title: タスク分割3のレビュー

  code:
    - progress: 90
      type: code_review
      title: コード実装のレビュー

  ui_integration:
    - progress: 90
      type: ui_integration_review
      title: UI統合のレビュー

  task_split_4:
    - progress: 90
      type: task_review_4
      title: タスク分割4のレビュー

  unit_test:
    - progress: 90
      type: unit_test_review
      title: 単体テスト結果のレビュー

  integration_test:
    - progress: 90
      type: integration_test_review
      title: 統合テスト結果のレビュー
