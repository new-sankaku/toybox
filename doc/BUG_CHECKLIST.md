# バグ・仕様バグ チェックリスト

Gitコミット履歴から抽出した、過去に発生したバグ・仕様バグの一覧です。
今後の開発・レビュー時のチェックリストとしてご活用ください。

---

## Client

### 型定義・インターフェース不整合
| 内容 | 回数 |
|------|------|
| WebSocket型定義がサーバー側イベントと一致していない（イベントハンドラ未定義、型定義漏れ）。推測ベースで構築していた | ×4 |
| 型定義にステータスが不足（新ステータス追加時に型・statusConfig両方の更新漏れ） | ×4 |
| barrel export漏れ（index.tsにexport追加忘れ） | ×1 |
| API型定義にサーバー側で追加されたフィールドが反映されていない | ×2 |
| TypeScript型エラー（未使用変数・関数の残存、型キャストの不整合） | ×1 |

### フォールバック・ハードコード問題
| 内容 | 回数 |
|------|------|
| サーバーからデータ取得失敗時にクライアント側でデフォルト値をフォールバック表示（ユーザー誤認の原因） | ×3 |
| プロバイダータイプがリバースマッピング失敗時のフォールバックとしてハードコード | ×2 |
| APIベースURL/WebSocketURLに`localhost`がフォールバック値としてハードコード（本番環境で誤接続） | ×2 |
| 選択肢定数（スケール、アセットサービス、レーティング等）がクライアント側TypeScriptに直接定義 | ×1 |
| 外部サービスのエンドポイントがlocalhostにハードコード | ×1 |
| メディア再生URLにlocalhostがプレフィックスとしてハードコード | ×1 |

### UI表示・操作問題
| 内容 | 回数 |
|------|------|
| ステータス集計にステータス追加漏れがありフィルタと不整合 | ×1 |
| 完了済みアクションのボタンが無効化されず操作可能だった | ×1 |
| 空配列・null値に対するオプショナルチェーン不足でクラッシュ | ×3 |
| エラー状態がUIに表示されない（error stateが未表示） | ×1 |
| ボタンの方向・アイコンが逆 | ×1 |
| 未実装機能のUIが残っていた | ×1 |
| ログレベルの色分けが不適切 | ×1 |
| 破壊的操作に確認ダイアログが未実装 | ×1 |
| 親子関係の集計にWorkerが混入し表示が不正確 | ×1 |
| デッドコードによる表示の誤動作 | ×1 |

### 機能未接続・動作不良
| 内容 | 回数 |
|------|------|
| 返信操作が既存データへの更新ではなく新規作成になっていた | ×1 |
| 操作対象ステータスの網羅漏れ（新ステータス追加時にボタン表示条件が未更新） | ×2 |
| 関数がconsole.logスタブのまま未実装（実際のAPI呼び出しがされない） | ×1 |
| propsが親コンポーネントから未接続でボタンが機能しない | ×1 |

### WebSocket・リアルタイム通信
| 内容 | 回数 |
|------|------|
| WebSocketイベントハンドラが未接続でリアルタイム更新されない | ×1 |
| WebSocketイベント型にフィールドが不足 | ×1 |
| WebSocketイベント受信時にデータがStoreに反映されない | ×1 |

### Store・状態管理
| 内容 | 回数 |
|------|------|
| Store内の配列に上限がなくメモリリーク | ×1 |
| 不要なレイヤーが残存（ライブラリ機能で代替可能） | ×1 |

### API同期
| 内容 | 回数 |
|------|------|
| バックエンドで削除済みのAPIメソッドがフロントエンドに残存し呼び出すと404 | ×1 |
| サーバー側に存在するAPIメソッドがクライアントに未定義 | ×1 |

---

## Server

### 実装漏れ・コールバック未接続
| 内容 | 回数 |
|------|------|
| Workerにコールバックが渡されておらず進捗・ログ・発言がフロントに到達しない | ×3 |
| Leader contextにコールバックが未設定でLeader-Workerパスのイベントが届かない | ×1 |
| Orchestratorでworkerのコールバックが未接続で子の発言がクライアントに届かない | ×1 |
| ストリームイベントを破棄していた | ×1 |
| DB migration漏れ（新規カラムのALTER TABLE未実行でSQLエラー） | ×1 |
| 新規パラメータがジョブ投入時に渡されていない | ×1 |
| シリアライズ用メソッドに新規フィールドが追加されずAPI応答でデータ取得不可 | ×1 |
| system_promptがMessages APIで正しく分離されず構造が破壊されていた | ×1 |

### 状態管理・並行処理バグ
| 内容 | 回数 |
|------|------|
| 状態復帰時に既存スレッドと新スレッドでAgent二重実行 | ×1 |
| コールバック設定により意図しない状態遷移が発生しフローがブロック | ×1 |
| 共有辞書がスレッドセーフでなかった（Lockなし） | ×2 |
| DB操作がアトミックでなかった（競合発生） | ×1 |
| WebSocket emitにroom指定が漏れていた | ×1 |
| 承認後のステータス遷移が未実装 | ×1 |
| 2つのコンポーネントが同じデータストアに並行書き込みし競合状態 | ×1 |

### ハードコード・設定値問題
| 内容 | 回数 |
|------|------|
| プロバイダーIDがデフォルト値としてハードコード | ×1 |
| モデル名・プロバイダー名がコード内にハードコード（動的解決すべき） | ×2 |
| max_tokensのデフォルト値がモデルの実際の出力上限と不一致 | ×1 |
| ファイル拡張子・スキャンディレクトリ等の設定値がコード内にハードコード | ×1 |
| 外部キーがNoneにハードコードされ親子関係を設定不可 | ×1 |
| Enum定義に重複エイリアスが存在 | ×1 |
| 設定にlabelがなくクライアントが表示名をハードコードする必要があった | ×1 |

### エラーハンドリング・ログ
| 内容 | 回数 |
|------|------|
| print()がlogger使用の代わりに使用されていた | ×1 |
| bare except/except passでエラーが握りつぶされていた | ×2 |
| exc_info=Trueが例外ハンドラに付与されておらずスタックトレースが記録されない | ×1 |
| 初期化失敗時にログが出ない（except passのまま） | ×1 |
| エラーレスポンスが統一形式ではなくクライアント側のハンドリングが不整合 | ×1 |

### セキュリティ
| 内容 | 回数 |
|------|------|
| パストラバーサル脆弱性（ファイル名の検証なし） | ×1 |
| URL解析失敗時にアクセスがブロックされない | ×1 |
| 例外情報（内部実装詳細）がクライアントに漏洩 | ×1 |
| シンボリックリンク対策がなかった | ×1 |
| ファイルアップロードにディスクフル対策・書き込みエラーハンドリングがなかった | ×1 |
| リクエストサイズ上限が未設定 | ×1 |

### LLM/AI API関連
| 内容 | 回数 |
|------|------|
| ストリーミング時のトークン使用量が記録されなかった（stream_options未設定） | ×1 |
| usage未取得時にも空のfinalチャンクが出力されストリーム終了判定が誤動作 | ×1 |
| 実行結果のtokens_usedがresultオブジェクトに格納されず消失 | ×1 |
| API接続エラー時に無限リトライで待機しAPI負荷を増大 | ×1 |
| 結果型にトークン集計用フィールドが不足 | ×1 |
| ジョブ失敗時のリトライロジックが未実装 | ×1 |
| 品質チェックリトライ時に前回の問題点がプロンプトに反映されなかった | ×1 |
| プロンプトテンプレートに未使用変数が残存 | ×1 |

### 設計・アーキテクチャ問題
| 内容 | 回数 |
|------|------|
| リカバリ処理がサーバー起動時に全スキャンし正常動作中のプロセスも停止させてしまう | ×1 |
| 同時実行制御がインメモリのためサーバー再起動で状態喪失 | ×1 |
| グローバル同時実行数制限でプロバイダー間で枠を奪い合う問題 | ×1 |
| グループとプロバイダーの制限値が二重チェックされ低い方で制限される仕様バグ | ×1 |
| 残留ジョブがpendingに戻されて意図せず再実行される仕様バグ | ×1 |
| プロジェクト開始/再開時に前回の未完了ジョブがクリーンアップされない | ×1 |
| 特定モード指定時にfactoryが対応クラスを生成できずエラー | ×1 |
| 非同期/同期の不一致でハンドラ側で適切に処理されなかった | ×1 |
| 処理の記録（トレース）が未実装 | ×1 |
| 再実行トリガーが未実装 | ×1 |
| 後続処理の自動再開ロジックが未実装 | ×1 |
| 定期クリーンアップがなくメモリリークの可能性 | ×1 |
| SQLite WALモードとbusy_timeoutが未設定（同時アクセスで問題発生） | ×1 |

---

## カテゴリ別サマリー

### 頻出パターン（要重点チェック）
| カテゴリ | 合計 | 説明 |
|----------|------|------|
| 型定義・インターフェース不整合 | ×12 | サーバー側で追加した型・ステータス・フィールド・イベントがクライアント側に反映されない |
| フォールバック・ハードコード（C+S） | ×17 | クライアント側にデフォルト値やURL、サーバー側にプロバイダーID/モデル名がべた書き |
| 実装漏れ・コールバック未接続 | ×10 | 新機能追加時にコールバックや伝播パスが接続されていない、DB migrationの漏れ |
| 状態管理・並行処理 | ×8 | スレッドセーフ未対応、二重実行、状態遷移の不整合、競合状態 |
| UI表示・操作・機能不良 | ×17 | クラッシュ、未接続props、スタブ関数の放置、確認ダイアログ欠如 |
| エラーハンドリング不足 | ×6 | print使用、エラー握りつぶし、スタックトレース未記録 |
| セキュリティ | ×6 | パストラバーサル、情報漏洩、symlink対策、アクセス制御不備 |
| LLM/AI API | ×8 | トークン計測漏れ、リトライ不足、ストリーム終了判定の誤り |
| 設計・アーキテクチャ | ×13 | リカバリ設計、同時実行制御、ジョブライフサイクル、DB設定 |
