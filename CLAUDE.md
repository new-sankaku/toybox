# CLAUDE.md

・修正後はdoc/BUG_CHECKLIST.mdを確認しバグを作り込んでいないか確認する。同様の問題が発生した場合は×1などの回数をインクリメントする。
・AIサービスはサーバー側設定ファイルとして持たせる。
・同じ設定を複数の設定ファイルに分割せず一つにする。
・画面側にAIサービスはハードコーディングしない。
・AI APIのプロバイダー・モデルをコード内にハードコードしない。設定ファイルまたはプロジェクト設定から動的に解決する。
・安易な解決策を採用するな。
・代替案は提示して許可をとれ。
・実装はアルゴリズムの選定を行え。
・ベストプラクティスを採用しろ。
・意味のない質問はするな。質問が必要なら意図を明確にして何故その質問をしたか書け。
・固定値は避けてフレキシブルなUIにする。
・AIサービスは固定でWeb上に表示しない。AIサービスはプロジェクトによって使う使わないがあるので、使わないものは表示しない。
・クライアント画面でのフォールバック処理はユーザーを誤認させるため行わない。誤認の心配がない場合は可能。
・フォールバック処理を行う前に根本的対策を行う。
・サーバーからデータが取得できないためのフォールバックは禁止。
・サーバー側に設定値を持たせ、クライアント側ではべた書きなど設定値は持たない。
・常に敬語を使う。
・コメントはTODO以外は不要
・バックエンドでprint()は禁止。必ず`from middleware.logger import get_logger`を使用し、`get_logger().info/warning/error()`で出力する。例外ハンドラ内のerrorログには`exc_info=True`を付与してスタックトレースを残す。
・Sonnet Haikuをサブエージェントとすることは禁止、サブエージェントは基本的にOpusを使用する。
・曖昧な可能性で直すな。論理的な根拠を持って直せ。
・ドキュメントは全てdocフォルダに格納する。
・エージェントシステムのため、プロンプトを固めるのではなく普遍的な方針を記載し、各エージェントが判断できるようにする。硬直化したプロンプトは記載しない。
・CSSの固定幅指定は行わない。フレキシブルデザインにする。

- **Agent**: AIエージェント（concept_leader, design_workerなど）。独立した実行単位。1つのAgentは特定の役割を持つ。
- **Task**: Agentが実行する個別の作業単位。1つのAgentが複数のTaskを実行することがある。AgentとTaskは別物であり、混同しないこと。
- **nulファイルの作成禁止** - Windowsで出力を破棄する場合、`> nul` を使用しない（`nul`という名前のファイルが作成されてしまう）。代わりに `> /dev/null 2>&1` を使用するか、出力リダイレクトを使わない。
- **応急処置の禁止** - インラインスタイル（`style={{ }}`）でのべた書きは禁止。必ずTailwindクラスまたはCSSファイルを使用すること。
- **推測での修正禁止** - 「たぶんこれだろう」で修正を始めない。必ず問題の要素を特定してから修正すること。
- **同じ調査の繰り返し禁止** - 同じ問題が再度発生した場合、前回と同じ視点で調査しない。別の観点（親要素、子要素、関連コンポーネント、CSS継承、Tailwind設定など）から調べ直すこと。
- **誤認させるデフォルト値禁止** - API取得失敗時などに、実際とは異なる値をデフォルト値として画面に表示しない。取得失敗時は「-」や空欄、または「取得失敗」等の明示的な表示にすること。ユーザーを誤認させる情報を表示してはならない。
- **文言の統一** - 画面に表示する文言（ラベル、ボタン、メッセージ等）は他の画面と統一的な表現にすること。新しい文言を追加する前に、既存の画面で使われている表現を確認して合わせる。



## コード圧縮

トークン削減のためコードを圧縮する:
```bash
  # TypeScript（langgraph-studio）
  cd langgraph-studio
  npm run lint        # ESLint適用
  npm run format      # 演算子スペース削除

# Python（backend）
cd backend
python scripts/remove-spaces.py
```

**圧縮ルール（共通）:**
- コロン/カンマ後: スペースなし
- アロー演算子前後: スペースなし
- コメント: 削除（TODO/FIXME以外）
- 文字列内: 保持

**TypeScript追加ルール:**
- インデント: 1スペース



## 2. Color System

### 2.1 Primary Palette (Source: index.html)

```css
:root {
  /* ===== Background Colors ===== */
  --bg-main: #E8E4D4;        /* メイン背景 */
  --bg-panel: #DAD5C3;       /* パネル背景 */
  --bg-selected: #CCC7B5;    /* 選択状態 */
  --bg-header: #57534A;      /* ヘッダー/フッター */
  --bg-footer: #57534A;

  /* ===== Text Colors ===== */
  --text-main: #454138;      /* メインテキスト */
  --text-light: #7A756A;     /* サブテキスト */
  --text-header: #E8E4D4;    /* ヘッダー内テキスト */
  --text-footer: #E8E4D4;    /* フッター内テキスト */

  /* ===== Accent Colors (Category Markers) ===== */
  --accent-red: #B85C5C;     /* システム/エラー/Critical */
  --accent-orange: #C4956C;  /* 実行中/Warning */
  --accent-yellow: #C9C078;  /* 待機中/Pending */
  --accent-green: #7AAA7A;   /* 完了/Success */
  --accent-blue: #6B8FAA;    /* 情報/Info */

  /* ===== Borders ===== */
  --border-light: rgba(69, 65, 56, 0.2);
  --border-dark: rgba(69, 65, 56, 0.4);
}
```

### 2.2 Color Usage Matrix

| 用途 | カラー | CSS変数 |
|------|--------|---------|
| メイン背景 | `#E8E4D4` | `--bg-main` |
| パネル背景 | `#DAD5C3` | `--bg-panel` |
| 選択状態 | `#CCC7B5` | `--bg-selected` |
| ヘッダー/フッター | `#57534A` | `--bg-header` |
| メインテキスト | `#454138` | `--text-main` |
| サブテキスト | `#7A756A` | `--text-light` |
| ヘッダー/フッターテキスト | `#E8E4D4` | `--text-header` |

### 2.3 Category Color System

```
┌─────────────────────────────────────────────────────────────────┐
│  CATEGORY MARKERS - 状態を示す4px縦線                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ██  --accent-red     #B85C5C   システム/エラー/Critical        │
│  ██  --accent-orange  #C4956C   実行中/Warning/進行中           │
│  ██  --accent-yellow  #C9C078   待機中/Pending/Human待ち        │
│  ██  --accent-green   #7AAA7A   完了/Success/承認済み           │
│  ██  --accent-blue    #6B8FAA   情報/Info/参照                  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```
